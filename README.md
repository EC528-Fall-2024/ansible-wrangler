# Ansible Wrangler

## Members:
| Name | Role | Contact Information |
| :---: | :---: | :---: |
| Ryan Cook | Mentor  | rcook@redhat.com |
| Albert Zhao | Contributor | albertz@bu.edu |
| Reza Sajjadi | Contributor | sajjadi@bu.edu |
| Jack Edelist | Contributor | edelist@bu.edu |
| Arthur Hua | Contributor | ahua102@bu.edu |
| Michael Barany | Contributor | mbarany@bu.edu |
| Alireza Roshandel | Contributor | alirezad@bu.edu |

## Progress
[Sprint 1 Demo](https://drive.google.com/drive/folders/19N2t67B59QdDt1MnHAf7CkfM7lJ14rJK?usp=sharing)

[Sprint 2 Demo](https://drive.google.com/drive/folders/1Zj_zdQ7Hdqzi7-cDt-tku3rnGXbvKtWH?usp=sharing)

[Sprint 3 Demo](https://drive.google.com/drive/folders/1ChZvkJFYUFSo1Nl7DjrvoWRS28i35qFZ?usp=sharing)

## Setup
Install Ollama and run it using "ollama serve" on terminal

conda env create -f environment.yml

conda activate faiss_env

python main.py


## Project Background and Description
The Ansible Wrangler Automation project is a fully automated solution that integrates ServiceNow incident management with Ansible playbook generation and Github repository management. This project aims to simplify and streamline the process of generating, managing, and deploying Ansible playbooks in response to incidents reported by ServiceNow users. This system automates the process of identifying incidents, creating appropriate Ansible playbooks via a Gen AI API, e.g., openAI API, checking for pre-existing playbooks, and pushing changes to a GitHub repository through pull requests. Overall this project should reduce the time between reporting an error and getting feedback from another software developer by having a solution be generated immediately. This should allow more people to be able to use ansible without having in-depth knowledge about how to fine-tune their system.

## Visions and Overall Goals
Our vision is to reduce manual efforts involved in incident management and playbook creation, and create a fully automated pipeline that helps companies and software developers streamline their problem-solving process. 

The preliminary goal is to create a system where users can pass code alongside an error message to a chat-based interface, such as Slack or other bot-accessible systems which is most utilized by the company using the platform (in this case RedHat). The bot with then use this information to generate a prompt that leverages an LLM to search through a git repository populated with potentially relevant playbooks that address issues. It will then determine if a suitable playbook exists and return it to the user. 

If no suitable playbook exists, the AI will dynamically generate one based on its understanding of the error, the provided code, and historical data similar to this issue. The ideal playbook will offer a step by step guide in resolving the issue which can be stored for future use. 

This automation reduces the need for manual troubleshooting and playbook creating, helping teams efficiently address issues and continuously enhance their internal databases.

## Users and Personas of the Project
### Site Reliability Engineer (SRE): 
- Key Characteristics:
  -  Responsible for ensuring high availability, performance, and security of infrastructure
  - Frequently responds to incidents and investigates operational issues
  - Familiar with Ansible and monitoring platforms (e.g. Prometheus, Grafana)
  - Needs rapid and reliable solutions for infrastructure problems
  - Comfortable working with playbook and scripts
- Primary Actions:
  - Receives alerts about system issues from monitoring systems or incident platforms
  - Reviews and approves proposed Ansible playbooks generated by Ansible Wrangler
  - Initiates playbook execution to resolve detected issues
  - Provides feedback on playbook performance to improve future remediations
### System Administrator (SysAdmin): 
- Key Characteristics:
  - Manages and maintains the core Linux/Kubernetes infrastructure
  - First point of contact for infrastructure-related issues
  - Maintains repositories of standard playbooks and updates these based on system changes
  - Looks for ways to streamline repetitive tasks through automation
- Primary Actions:
  - Reviews and updates playbooks generated by Ansible Wrangler before merging them into production
  - Suggests improvements to existing playbooks for more efficient operation
  - Ensures new system updates or configurations are integrated into playbooks
### Security Engineer
- Key Characteristics:
  - Responsible for ensuring the security and compliance of the OS and infrastructure
  - Identifies and remediates security incidents, vulnerabilities, and misconfigurations
  - Reviews security impact of proposed playbooks
- Primary Actions:
  - Audits generated playbooks to ensure they adhere to security policies
  - Validates that proposed remediations don’t introduce new vulnerabilities or compliance issues
  - Provides feedback on security aspects of automation processes
### DevOps Engineer
- Key Characteristics:
  - Bridges gap between development and operations, and maintains CI/CD pipelines
  - Integrates playbooks into deployment workflows and continuous automation pipelines
- Primary Actions:
  - Manages and merges playbooks into Git repositories.
  - Automates playbook execution as part of CI/CD pipelines.
  - Ensures that proposed playbooks are tested and reliable before deployment. 

## Scope and Features of the Project
### ServiceNow Integration: 
Automatically queries ServiceNow to fetch incidents based on a specific user and updates the state of incidents after processing
### AI-Generated Playbooks: 
Uses OpenAI’s GPT model to generate Ansible playbooks based on incident descriptions when no suitable existing playbook is found 
### GitHub Automation: 
Automatically pushes generated playbooks to a Github repository, creates new branches, and submits pull requests for review
### Existing Playbook Search: 
Searches a repository of existing playbooks for a match to avoid duplicate playbook generation.

## Additional Features to be Considered
These are some of the features that we could implement after the completion of our main objectives. 
### Incident Feedback Loop: 
implement feedback mechanism for SREs to rate effectiveness of generated playbooks
### Incident categorization: 
use generative AI to categorize incidents into different severity levels and assign relevant actions or workflows automatically
### ChatOps Integration: 
integrate with Slack, Microsoft Teams or other chat platforms to allow playbook generation within team chats, or direct access through 1-on-1 chat with an Ansible Wranger “bot”
### Further Cloud and Queue Integration:
Using different queue structures to prioritize different tasks and requests when handling a large load of incident requests. 

## Solution Concept and General Architectural of the Project:
This project follows a modular architecture that integrates several components to automate incident handling and playbook generation. Below is a general architectural overview and workflow of the project: 
Architectural components:
1. ServiceNow: This is the starting point of the workflow, where incidents are generated and managed. We will utilize ServiceNow API to fetch incidents.
2. Ansible Wrangler Automation: The core of this automation engine that:
   - Incident Retrieval: get incidents created by users from ServiceNow.
   - Playbook Search Module: searches for existing playbooks in a GitHub repo to check for a match with the incident description
   - OpenAI API Interaction: if no match is found, this module generates a new Ansible playbook using the OpenAI GPT model based on the description of the incident.
   - GitHub API Integration: Automatically submits a pull request to a specific GitHub repo for the newly generated playbook
   - Incident State Updater: Updates the state of the incident in ServiceNow to notify the user about the action taken. 
3. GitHub Repository: A version control system where the existing playbooks are stored, and new playbooks are committed. We will be using the GitHub API to manage the repository, branches, commits, and pull requests. 
4. OpenAI API: The natural language processing model (GPT) that interprets incident descriptions and generates Ansible playbooks.

### General Flow of Data and Interaction:
<img width="811" alt="image" src="https://github.com/user-attachments/assets/eaec2984-7cc5-47b4-95fd-66038453f5c6">

This solution is scalable, allowing it to be expanded or enhanced with more features, such as intelligent playbook customization, based on the timeline and evolving project needs.

## Design Implications and Discussion
1. API-Driven Architecture: The decision to use an API-driven architecture ensures flexibility and scalability. By integrating with ServiceNow, Gen AI API, and GitHub APIs, the system is modular and can easily be expanded to include other services in the future.
2. Using Existing Language Models for Playbook Generation: allows the system to automatically create customized and relevant Ansible playbooks based on incident descriptions. This reduces manual intervention and accelerates incident resolution. Using a pre-trained model also enhances efficiency while ensuring that the system can adapt to various types of incidents with minimal human input.
3. Automation: The whole point of this project is to use automation to speed up incident report. By eliminating manual steps, the system can quickly respond to incidents, reducing resolution times and ensuring a consistent, repeatable workflow.

## Acceptance Criteria
We want to make sure that the core functionality of the Ansible Wrangler Automation project is met. To ensure this, essential features and capabilities must be implemented and verified for this project to be complete. Essential features include:
- ServiceNow Incident Retrieval
- Existing Playbook search
- OpenAI (or other language model) playbook generation
- GitHub Integration
- ServiceNow incident update

## Release Planning 
This project will be delivered in a series of iterative releases, each introducing new features and functionality incrementally. 

### Release overview
Each release will focus on a specific set of features, starting with the core functionality of the system and expanding to include advanced capabilities such as playbook validation, error handling, and enhanced integration. 

#### First Sprint Study, Research and Core Infrastructure Setup

In the first sprint, we focused on researching all the necessary frameworks, structures, and APIs for this project. We researched multiple LLMS (OpenAI and Llama) to see which model is faster and more efficient for Ansible playbook generation. We also researched Rest API to see how data can be transferred between different modules within our project. We also investigated different cloud services and structures to apply the best cloud application. 

Please see below for our sprint 1 slides and presentation: https://drive.google.com/drive/folders/19N2t67B59QdDt1MnHAf7CkfM7lJ14rJK?usp=drive_link

#### Second Sprint: Core Functionality

The goal of the second sprint is to establish the core structure of the Ansible Wrangler Automation system and implement basic functionalities that enable the system to handle incidents efficiently. 
- Develop a simple and intuitive front-end interface where users can submit incident requests. This interface will collect relevant information such as the error description, code snippets (if applicable), urgency, state of the issue, and any additional context needed to resolve the issue.
  - This interface could be integrated into existing chat platforms like Slack, or it could be a standalone web form that communicates with the backend system via REST API calls.
- Implement a search algorithm to scan the existing repository of playbooks for a match.
- Integrate a LLaMA Language Model dynamically generate new Ansible playbooks when no suitable existing playbook is found.
- The system will analyze the incident description and any provided code to create a customized playbook. This playbook will be in YAML format and structured to resolve the issue step-by-step.
  

#### Third Sprint: GitHub Integration and Pull Requests 

#### Fourth Sprint: Advanced Features and Stretch Goals

Key Deliverables Per Release
- Release 1: Core system infrastructure, logging, and initial API connections.
- Release 2: Full playbook generation pipeline, including incident retrieval, GPT-based generation, and playbook commits.
- Release 3: GitHub integration with pull request creation, validation, and error handling.
- Release 4: Advanced features, scalability improvements, and user notifications.

Each sprint will conclude with a sprint review, where feedback will be collected to guide the next sprint. The first release is expected to provide the foundational elements of the system, with each subsequent release building upon it and adding more advanced features.


## General Comments
We plan to scale this project based on the available timeline, with the potential to expand its functionality and incorporate additional features. As the project progresses, we will evaluate opportunities for enhanced automation, improved playbook matching algorithms, and integration with other platforms to make sure the system remains flexible and adaptable to future needs/progress. 

## Resources
https://github.com/cooktheryan/wrangler

https://github.com/cooktheryan/wrangler-out/pull/44/files

https://docs.ansible.com/

